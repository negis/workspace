package view;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;
import java.util.List;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JList;
import javax.swing.JPanel;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.SwingUtilities;
import javax.xml.bind.JAXBException;
import model.channel;
import model.item;

import controller.connector;

public class GUI extends JFrame { 
	
	JTextField urlField;
	JList jl;
	JTextArea detail;
	List<item> itemList;
	private FlowLayout f = new FlowLayout();


    public GUI() {
        
       setTitle("RSS READER");
       setSize(300, 200);
       setDefaultCloseOperation(EXIT_ON_CLOSE);    
       
       BorderLayout bl = new BorderLayout();
       this.setLayout(bl);
       initComponent();
    }

	private void initComponent() {
		JPanel topPanel = new JPanel();
		JPanel jp2 = new JPanel();
		topPanel.setLayout(f);
		jp2.setLayout(f);
		
		urlField = new JTextField();
		urlField.setPreferredSize(new Dimension(300,20));
		JButton connectButton = new JButton("Connect");
		connectButton.addActionListener(new ActionListener()
        {
            public void actionPerformed(ActionEvent ae)
            {
                connector ct = new connector();
                try {
                	addListNaja(ct.getObjectFromUrl(new URL(urlField.getText())));
				} catch (MalformedURLException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				} catch (JAXBException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
                
            }
        });
		
		topPanel.add(urlField);
		topPanel.add(connectButton);
		
		jl = new JList();
		jl.setPreferredSize(new Dimension(350,400));
		detail = new JTextArea();
		detail.setPreferredSize(new Dimension(400,400));
		detail.setLineWrap(true);
		detail.setAutoscrolls(true);
		
		jl.addMouseListener(new MouseAdapter() {
		    public void mouseClicked(MouseEvent evt) {
		    	detail.setText(itemList.get(jl.getSelectedIndex()).getDescription());
		    }
		});
		
		
		
		jp2.add(jl);
		jp2.add(detail);
		

		this.add(topPanel,BorderLayout.NORTH);
		this.add(jp2, BorderLayout.SOUTH);
		this.pack();
	}
	
	private void addListNaja(List<channel> cn) {
		
		itemList = cn.get(0).getLit();
		List<String> title = new ArrayList<String>();
		
		for(item e: itemList){title.add(e.getTitle());}
		jl.setListData(title.toArray());

	}
    
}
